<!DOCTYPE html>
<html lang = "en">
   <head>
      <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
      <script src="https://d3js.org/d3.v4.js"></script>
      <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
      <style>
      .w3-btn {margin-bottom:10px;}
      </style>      
   </head>
   <body onload = 'init()'>
      <div id="my_dataviz">
      </br>
      <button id = "redbutton" class="w3-button w3-white w3-border w3-border-red w3-round-large" onclick = "showhide(this)">Coal</button>
      <button class="w3-button w3-white w3-border w3-border-green w3-round-large">Oil</button>
      <button class="w3-button w3-white w3-border w3-border-olive w3-round-large">Flaring</button>
      <button class="w3-button w3-white w3-border w3-border-purple w3-round-large">Gas</button>
      <button class="w3-button w3-white w3-border w3-border-pink w3-round-large">Cement</button>
      <button class="w3-button w3-white w3-border w3-border-yellow w3-round-large">Other</button>
      </div>
      
      <script>
         function showhide(t)
         {
            if(t.id == "redbutton")
            {
               var opacity = d3.select('#redline').style("opacity");

               alert(opacity);
               if(opacity == 0)
               {
                  d3.select("#redline")
                  .style("opacity", 1);
               }
               else
               {
                  d3.select("#redline")
                  .style("opacity", 0);
               }
            }

         }

      // set the dimensions and margins of the graph
      var margin = {top: 50, right: 30, bottom: 30, left: 100},
      width = 1200 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;


      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform",
         "translate(" + margin.left + "," + margin.top + ")");



         svg.append("circle")
         .attr('id','my_cirOil')
         .attr('cx',50)
         .attr('cy',50)
         .attr('r',10)
         .style('fill','pink')
         .style('stroke-width','1');

         svg.append("circle")
         .attr('id','my_cirCoal')
         .attr('cx',50)
         .attr('cy',60)
         .attr('r',10)
         .style('fill','red')
         .style('stroke-width','1');       
         
         svg.append("circle")
         .attr('id','my_cirCement')
         .attr('cx',50)
         .attr('cy',70)
         .attr('r',10)
         .style('fill','purple')
         .style('stroke-width','1');            

         //let arrYears = new Array ();

         let arrOilEmission = new Array();
         var OilEmissionStart = {date : 1972, value : 0};

         let arrFlarEmission = new Array();
         var FlasEmissionStart = {date : 1972, value : 0};

         let arrCementEmission = new Array();
         var CementEmissionStart = {date : 1972, value : 0};

         let arrCoalEmission = new Array();
         var CoalEmissionStart = {date : 1972, value : 0};

         let arrGasEmission = new Array();
         var GasEmissionStart = {date : 1972, value : 0};

         let arrOtherEmission = new Array();
         var OtherEmissionStart = {date : 1972, value : 0};

         //let arrData = new Array();

         async function init()
         {
            await d3.csv("./Data/co2-emissions-by-fuel-line.csv", 
               function(consdata) {
                  if (consdata["Entity"] == "World") 
                  { 
                     var dtOil = { date : d3.timeParse("%Y")(consdata.Year), value : consdata['CO2 emissions from oil'] };
                     arrOilEmission.push(dtOil);
                     if(OilEmissionStart.value == 0 && dtOil.value > 0)
                     {
                        OilEmissionStart = dtOil;
                     }

                     var dtFlar = { date : d3.timeParse("%Y")(consdata.Year), value : consdata['CO2 emissions from flaring'] };
                     arrFlarEmission.push(dtFlar);
                      if(FlasEmissionStart.value == 0 && dtFlar.value>0)
                      {
                         FlasEmissionStart = dtFlar;
                      }

                     var dtCement = { date : d3.timeParse("%Y")(consdata.Year), value : consdata['CO2 emissions from cement'] };
                     arrCementEmission.push(dtCement);  
                      if(CementEmissionStart.value == 0 && dtCement.value >0)
                      {
                         CementEmissionStart = dtCement;
                      }

                     var dtCoal = { date : d3.timeParse("%Y")(consdata.Year), value : consdata['CO2 emissions from coal'] };
                     arrCoalEmission.push(dtCoal);

                     var dtGas = { date : d3.timeParse("%Y")(consdata.Year), value : consdata['CO2 emissions from gas'] };
                     arrGasEmission.push(dtGas);
                     
                     var dtOther = { date : d3.timeParse("%Y")(consdata.Year), value : consdata['CO2 emissions from other industry'] };
                     arrOtherEmission.push(dtOther);                     

                     return { date : d3.timeParse("%Y")(consdata.Year), value : consdata['CO2 emissions from oil'] }
                  } 
            },
            
            function(data)
            {

            // Add X axis --> it is a date format
            var x = d3.scaleTime()
               .domain(d3.extent(data, function(d) { return d.date; }))
               .range([ 0, width ]);
            svg.append("g")
               .attr("transform", "translate(0," + height + ")")
               .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
               .domain([0, d3.max(data, function(d) { return +d.value; })])
               .range([ height, 0 ]);
            svg.append("g")
               .call(d3.axisLeft(y));
            

               svg.append("path")
               .attr('id','pinkline')
                .datum(arrOilEmission)
                .attr("fill", "none")
                .attr("stroke", "pink")
                .attr("stroke-width", 2.5)
                .attr("d", d3.line()
                .x(function(d) { if(OilEmissionStart.date == d.date) d3.select('#my_cirOil').transition().duration(2000).attr('cx', x(d.date)).attr('cy',height - y(d.value)); return  x(d.date) })
                .y(function(d) { return y(d.value) })
                )  

                svg.append("path")
                .attr('id','redline')
                .datum(arrCoalEmission)
                .attr("fill", "none")
                .attr("stroke", "red")
                .attr("stroke-width", 2.5)
                .attr("d", d3.line()
                .x(function(d) { if(CoalEmissionStart.date == d.date) d3.select('#my_cirCoal').transition().duration(2000).attr('cx', x(d.date)).attr('cy',height - y(d.value)); return x(d.date) })
                .y(function(d) { return y(d.value) })
                )  


                svg.append("path")
                .attr('id','purpleline')
                .datum(arrCementEmission)
                .attr("fill", "none")
                .attr("stroke", "purple")
                .attr("stroke-width", 2.5)
                .attr("d", d3.line()
                .x(function(d) { if(CementEmissionStart.date == d.date) d3.select('#my_cirCement').transition().duration(2000).attr('cx', x(d.date)).attr('cy', height - y(d.value)); return x(d.date) })
                .y(function(d) { return y(d.value) })
                )  


                svg.append("path")
                .attr('id','oliveline')
                .datum(arrFlarEmission)
                .attr("fill", "none")
                .attr("stroke", "olive")
                .attr("stroke-width", 2.5)
                .attr("d", d3.line()
                .x(function(d) { return x(d.date) })
                .y(function(d) { return y(d.value) })
                )  

                svg.append("path")
                .attr('id','greenline')
                .datum(arrGasEmission)
                .attr("fill", "none")
                .attr("stroke", "green")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                .x(function(d) { return x(d.date) })
                .y(function(d) { return y(d.value) })
                )  

                svg.append("path")
                .attr('id','magentaline')
                .datum(arrOtherEmission)
                .attr("fill", "none")
                .attr("stroke", "magenta")
                .attr("stroke-width", 2.5)
                .attr("d", d3.line()
                .x(function(d) { return x(d.date) })
                .y(function(d) { return y(d.value) })
                )  
               });
         }
      </script>




      
   </body>
</html>