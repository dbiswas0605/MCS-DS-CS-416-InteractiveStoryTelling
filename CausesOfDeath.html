<!DOCTYPE html>
<script src="https://d3js.org/d3.v4.js"></script>
<script src ="./Javascripts/dropdown.js"></script>
<link rel="stylesheet" href="./CSS/dropdown.css">

<html lang = "en">
<body>
    <p>Leading causes of death</p>
    <table>
        <tr>
            <td align="top">
                <div class="dropdown">
                    <button onclick="myFunction()" class="dropbtn">Select Year</button>
                    <div id="myDropdown" class="dropdown-content">
                      <a href="#">Link 1</a>
                      <a href="#">Link 2</a>
                      <a href="#">Link 3</a>
                    </div>
                </div>
            </td>
            <td>
                <svg></svg>
            </td>
        </tr>
    </table>
      
    <div id = "tooltip"></div>

    <script>
        var margin = {top:15, left:150, right:50, botton:30};
        var width = 600 - margin.left - margin.right;
        var height = 500 - margin.top - margin.botton;

        d3.csv("./Data/annual-number-of-deaths-by-cause.csv", function(data)
        {
            DrawChart(data, 2000);
        });

        async function DrawChart(data, currentYearParam)
        {
            var csvColumns = data.columns;

            for(i=0;i<data.length;i++)
            {
                var csvValues = [];
                var currentYear = parseInt(data[i]["Year"]);

                if(currentYear != currentYearParam) continue;

                csvValues.push(parseInt(data[i]["Respiratory infections"]))
                csvValues.push(parseInt(data[i]["Cardiovascular diseases"]))
                csvValues.push(parseInt(data[i]["Alzheimer"]))
                csvValues.push(parseInt(data[i]["Chronic kidney"]))
                csvValues.push(parseInt(data[i]["Chronic respiratory"]))
                csvValues.push(parseInt(data[i]["Digestive diseases"]))
                csvValues.push(parseInt(data[i]["Hepatitis"]))
                csvValues.push(parseInt(data[i]["Parkinson disease"]))
                csvValues.push(parseInt(data[i]["Fire"]))
                csvValues.push(parseInt(data[i]["Malaria"]))
                csvValues.push(parseInt(data[i]["Drowning "]))
                csvValues.push(parseInt(data[i]["violence"]))
                csvValues.push(parseInt(data[i]["HIV/AIDS"]))
                csvValues.push(parseInt(data[i]["Tuberculosis"]))
                csvValues.push(parseInt(data[i]["Road injuries"]))
                csvValues.push(parseInt(data[i]["Alcohol use"]))
                csvValues.push(parseInt(data[i]["Diarrheal diseases"]))
                csvValues.push(parseInt(data[i]["Nutritional deficiencies"]))
                csvValues.push(parseInt(data[i]["Suicide"]))
                csvValues.push(parseInt(data[i]["Diabetes mellitus"]))
                
                var domainStart = parseInt(d3.min(csvValues))
                var domainEnd = parseInt(d3.max(csvValues))

                var x = d3.scaleLog().domain([domainStart,domainEnd]).range([0,width]);
                var y = d3.scaleLinear().domain([0,20]).range([0,20]);                
                var yColor = d3.scaleLinear().domain([0,20]).range(['red','orange']); 

                // Add X axis
                var xaxis = d3.scaleLog().domain([domainStart,domainEnd]).range([0, width]);
                // Add Y axis
                var yaxis = d3.scaleBand().domain(csvColumns).range([ 0, height]);
                var cols = csvColumns.splice(0,2);

                var barHeight = 17;
                var barSpacing = 5;
                
                var svg =   d3.select('svg')
                            .attr('width', width + margin.left + margin.right)
                            .attr('height', height + margin.top + margin.botton)
                            .append('g')
                            .attr("transform","translate(" + margin.left + "," + margin.top + ")");

                svg.selectAll('rect')
                .data(csvValues)
                .enter().append("rect")
                .attr('x', 0)
                .attr('y', function(d,i) {return y(i)* (barHeight + 5) + barSpacing})
                .attr('width', function(d) {return x(d);})
                .attr('height', barHeight)
                .style('fill', function(d,i) {return yColor(i)})

                svg.selectAll('text')
                .data(csvValues)
                .enter()
                .append('text')
                .attr('x',function(d) {return x(d);})
                .attr('y',function(d,i) { return y(i)* (barHeight + 6) + barSpacing})
                .style('font-size' , '10')
                .text(function(d) { return d})


                /*
                svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(xaxis));
                */

                
                svg.append("g")
                .call(d3.axisLeft(yaxis));

                console.log(currentYear)
                console.log(csvValues)
            }
        }
    </script>
</body>

</html>
